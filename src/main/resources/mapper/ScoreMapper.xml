<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wdd.studentManager.mapper.ScoreMapper">

    <resultMap type="com.wdd.studentManager.dto.ScoreDto" id="ScoreInfo">
        <result column="id" property="id"/>
        <result column="course_id" property="courseId"/>
        <result column="student_id" property="studentId"/>
        <result column="score" property="score"/>
        <result column="remark" property="remark"/>
        <result column="courseName" property="courseName"/>
        <result column="studentName" property="studentName"/>
    </resultMap>

    <select id="queryList" resultMap="ScoreInfo" >
        <!-- 根据条件查询 图书的所有信息 -->
        SELECT *
        from s_score
        <where>
            <if test="courseid!=null"> and course_id = #{courseid} </if>
            <if test="studentid!=null"> and student_id = #{studentid} </if>
        </where>
        limit #{startIndex},#{pagesize}
    </select>

    <select id="queryCount" resultType="int" >
        select count(*) from s_score
        <where>
            <if test="courseid!=null"> and course_id = #{courseid} </if>
            <if test="studentid!=null"> and student_id = #{studentid} </if>
        </where>
    </select>

    <select id="getAll" parameterType="com.wdd.studentManager.dto.ScoreDto" resultMap="ScoreInfo">
        select  s_score.*,s_course.name as courseName,s_student.username as studentName
        from s_score,s_course,s_student
        <where>
            s_score.course_id = s_course.id and s_score.student_id = s_student.id
            <if test="courseId!=null and courseId != ''"> and course_id = #{courseId} </if>
            <if test="studentId!=null and studentId != ''"> and student_id = #{studentId} </if>
        </where>
    </select>

    <select id="getAvgStats" parameterType="int" resultType="com.wdd.studentManager.dto.ScoreStatsDto">
        select max(s_score.scoreDto) as max_score,avg(s_score.scoreDto) as avg_score,min(s_score.scoreDto) as min_score,s_course.name as courseName
        from s_score,s_course
        where s_score.course_id=s_course.id and s_score.course_id = #{courseid}
    </select>


</mapper>